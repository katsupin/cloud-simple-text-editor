# スクロール仕様改善チケット

作成日: 2025-06-11
更新日: 2025-06-11
ステータス: Completed
優先度: Medium

## 概要
モバイル版とPC版のスクロール仕様のUXを統一し、使い勝手を向上させる

## 現状分析

### モバイル版とPC版のUXの違い

| 機能 | モバイル版 | PC版 | 差異 |
|------|------------|------|------|
| padding-bottom | calc(100vh - 200px) | calc(100vh - 250px) | モバイル版の方が小さい |
| スクロールコントロール | フローティングコントロール有り | なし | モバイル版のみ |
| タッチスクロール | -webkit-overflow-scrolling: touch | 通常スクロール | モバイル最適化 |
| スクロール位置ボタン | トップ/ボトムボタン有り | なし | モバイル版のみ |
| ファイル開いた時の位置 | 現在位置を維持 | 現在位置を維持 | 同じ（下端スクロールなし） |

### テキストのボトム表示について

**現在の実装状況:**
- ✅ PC版: 最下行を画面上部に表示可能（padding-bottom実装済み）
- ✅ モバイル版: 最下行を画面上部に表示可能（padding-bottom実装済み）

両方とも技術的には可能だが、モバイル版の方がpadding値が小さいため、若干の違いがある。

## 改善提案

### 1. ファイルを開いたときの自動スクロール機能

**提案内容:**
- ファイルを開いたときに自動的に最下端にスクロールする機能をPC版・モバイル版両方に実装
- 設定でON/OFFを切り替え可能にする

**メリット:**
- 日記やログファイルなど、最新の内容が下部にある場合に便利
- モバイル版の操作感をPC版でも実現

**デメリット:**
- ソースコードなど、上部から読むファイルには不適切
- ユーザーの期待と異なる動作の可能性

**実装案:**
```javascript
// processFileContent関数に追加
if (this.settings.autoScrollToBottom) {
    setTimeout(() => {
        editor.scrollTo({ 
            top: editor.scrollHeight, 
            behavior: 'smooth' 
        });
    }, 200);
}
```

### 2. PC版へのスクロールコントロール追加

**提案内容:**
- モバイル版のフローティングスクロールコントロールをPC版にも追加
- キーボードショートカットも併用可能に

**実装案:**
- Ctrl+Home: トップへスクロール
- Ctrl+End: ボトムへスクロール
- サイドバーに固定のスクロールボタンを配置

### 3. スクロール位置の記憶機能

**提案内容:**
- ファイルごとにスクロール位置を記憶
- 再度開いたときに前回の位置を復元

## アクションアイテム

- [x] ✅ **完了** 自動スクロール機能の実装
  - [x] 設定UIの追加（⚙️ボタンから設定ダイアログ表示）
  - [x] processFileContent関数への実装
  - [x] localStorage への設定保存
  
- [x] ✅ **部分完了** PC版スクロールコントロール
  - [x] キーボードショートカットの実装（Ctrl+Home/End）
  - [ ] UIコントロールの追加（オプション）
  
- [x] ✅ **完了** スクロール位置記憶機能
  - [x] ファイルごとのスクロール位置保存
  - [x] 復元ロジックの実装

## 実装済み機能

### 自動下端スクロール機能
- 設定ダイアログから有効/無効を切り替え可能
- デフォルトはOFF（ユーザーの意図しない動作を防ぐ）
- ファイルを開いた200ms後にスムーズスクロール
- localStorageで設定を永続化

### PC版キーボードショートカット
- Ctrl+Home: エディタ最上部へスクロール
- Ctrl+End: エディタ最下部へスクロール
- behavior: 'smooth'でスムーズスクロール実装

### スクロール位置記憶機能
- ファイルごとにスクロール位置を自動保存
- ファイルを開き直した時に前回の位置を復元
- 端末/ブラウザごとに独立して記憶（localStorage使用）
- 500msのデバウンス処理で効率的に保存
- 最大100ファイルの履歴を保持（古いものから自動削除）
- ファイル切り替え時、ページ離脱時に確実に保存

## ユーザビリティ評価

### 自動下端スクロールのユースケース評価

**適している場合:**
- 📝 日記・メモアプリ（最新の内容が下部）
- 📊 ログファイル（最新のログが下部）
- 💬 チャット風のメモ（時系列で追記）

**適していない場合:**
- 💻 ソースコード（上部から読むのが一般的）
- 📖 ドキュメント（冒頭から読むのが一般的）
- 📑 構造化されたテキスト（目次などが上部）

**推奨:**
デフォルトはOFFとし、ユーザーが必要に応じてONにできる設定として実装するのが最適。

## 次のステップ

1. ユーザーからのフィードバックを収集
2. 優先度の高い機能から段階的に実装
3. A/Bテストによる使い勝手の検証