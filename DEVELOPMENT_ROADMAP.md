# Cloud Simple Text - 開発ロードマップ & 課題管理

## 📋 課題管理システム

### 優先度定義
- **🔥 High (高)**: セキュリティ、データ損失、重要な機能不具合
- **⚡ Medium (中)**: ユーザビリティ改善、パフォーマンス向上
- **✨ Low (低)**: UI改善、微細な機能追加

### ステータス定義
- **Pending**: 未着手
- **In Progress**: 作業中
- **Under Review**: レビュー・テスト中
- **Completed**: 完了
- **On Hold**: 保留中

---

## 🎫 現在の課題チケット

### #001 - 🔥 データ競合調査: 編集中の自動更新によるテキストロスト
**優先度**: High  
**ステータス**: ✅ 調査完了 → 修正開始  
**報告日**: 2025-06-10  
**調査完了日**: 2025-06-10

**🔍 調査結果 - 根本原因特定**:

**問題の核心**: 編集検出ロジックの不完全性により、実際の編集中でも自動更新が実行される

**具体的な問題**:
1. **編集検出の時間窓の問題**
   - `onUserEdit()` で5秒のタイムアウトを設定
   - しかし `isUserEditing()` は `lastEditTime` から5秒経過で編集終了と判定
   - **連続タイピング中断時に編集中フラグが無効になる**

2. **イベント検出の不備**
   - keydown, paste のみ検出
   - **input イベントは onEditorChange() のみで onUserEdit() を呼ばない**
   - IME入力、オートコンプリート、ドラッグ&ドロップが検出されない

3. **タイミング競合**
   - 3秒間隔の同期チェック
   - 編集停止後1-2秒で同期実行される可能性
   - ユーザーが「まだ編集中」と感じるタイミングで更新発生

**再現パターン**:
```
1. ユーザーA: 文章を入力中
2. 5秒間ポーズ（考え中）
3. システム: 編集終了と判定
4. ユーザーB: 別端末で保存
5. システム: ユーザーAの画面を自動更新 ← ここでロスト発生
6. ユーザーA: 入力再開するも、途中まで書いた内容が消失
```

**緊急修正計画**:
- [x] 編集検出ロジックの調査完了
- [x] 編集検出イベントの拡張（input, composition, cut等）
- [x] 編集検出タイムアウトの延長（5秒→15秒）
- [x] より保守的な同期ロジックに変更
- [x] 編集中表示の改善（同期インジケーターでの視覚フィードバック）

**実装済み修正**:
1. **イベント検出の完全化**: input, keyup, cut, composition* イベントを追加
2. **タイムアウト延長**: 編集中判定を15秒に延長
3. **二重チェック**: 自動更新直前の最終確認を追加
4. **段階的リトライ**: 20秒間隔での安全な再試行
5. **UI改善**: 編集中状態の視覚的フィードバック

**影響範囲**: 全ユーザー  
**実装完了**: 2025-06-10

---

### #002 - ⚡ スクロール機能: 各ノートの最下行を画面最上部に表示
**優先度**: Medium  
**ステータス**: ✅ 実装完了  
**報告日**: 2025-06-10  
**完了日**: 2025-06-10

**問題詳細**:
- 長いノートで最下行が見にくい
- エディタの下端にパディングがないため、最後の行が読みづらい

**実装済み**:
- ✅ エディタエリアに動的パディング追加
- ✅ デスクトップ版: `padding-bottom: calc(100vh - 250px)`
- ✅ モバイル版: `padding-bottom: calc(100vh - 200px)`
- ✅ 全プラットフォーム対応完了

**効果**: 長いノートの最下行が画面最上部まで表示可能になり、読みやすさが向上

---

### #003 - ✨ UI改善: ログアウトアイコンをログインアイコンと対になるデザインに
**優先度**: Low  
**ステータス**: ✅ 実装完了  
**報告日**: 2025-06-10  
**完了日**: 2025-06-10

**実装済み**:
- ✅ ログイン: 🔐 (鍵・ロック)
- ✅ ログアウト: 🔓 (オープンロック) 
- ✅ 直感的なアイコンペアで統一感を向上

**効果**: ユーザビリティ向上、視覚的統一感の改善

---

### #004 - 🚨 緊急修正: データ競合によるテキストロスト防止
**優先度**: High  
**ステータス**: ✅ 実装完了 → デプロイ準備中  
**作成日**: 2025-06-10  
**完了日**: 2025-06-10

**修正内容**:
1. ✅ 編集検出イベントの拡張 (input, keyup, cut, composition*)
2. ✅ 編集タイムアウトの延長（5秒→15秒）
3. ✅ より保守的な同期ロジック（20秒リトライ、最終確認）
4. ✅ 編集中UI表示の改善（同期インジケーター）

**効果**: データロストリスクを大幅に軽減

---

### #005 - ⚡ エディタ機能: 不可視文字表示（改行・スペース等を記号で表示）
**優先度**: Medium  
**ステータス**: ✅ 実装完了  
**報告日**: 2025-06-10  
**完了日**: 2025-06-10

**実装済み機能**:
- ✅ 改行文字を ↵ で表示
- ✅ スペースを · (中点) で表示  
- ✅ タブ文字を → で表示
- ✅ 全角スペースを □ で表示
- ✅ トグルボタンで表示/非表示の切り替え（エディタヘッダーに ¶ ボタン）

**技術実装**:
- **オーバーレイ方式**: エディタ上に透明なオーバーレイを配置
- **リアルタイム同期**: 入力・スクロールと連動して更新
- **レスポンシブ対応**: デスクトップ・モバイル両対応
- **パフォーマンス配慮**: 不可視文字表示時のみ処理実行

**UI/UX**:
- エディタヘッダーの ¶ ボタンでトグル
- アクティブ時は青色でハイライト
- 不可視文字は薄いグレー(50%透明度)で表示
- エディタのスクロールと完全同期

**効果**: テキスト整形の精度向上、隠れた空白文字の発見が容易に

---

## 🛠️ 技術負債 & 将来の改善計画

### コードベース改善
- [ ] TypeScript化検討
- [ ] コンポーネント分割（モジュール化）
- [ ] テストスイート構築

### 機能拡張
- [ ] ダークモード完全対応
- [ ] オフライン編集サポート
- [ ] 複数ユーザー同時編集（リアルタイム）
- [ ] ファイル履歴ビューア

### パフォーマンス
- [ ] 大容量ファイル対応（仮想スクロール）
- [ ] 画像・添付ファイルサポート
- [ ] PWA対応

---

## 📊 リリース計画

### ✅ v2.1 (緊急修正) - 完了: 2025-06-10
- ✅ #001/#004 データ競合修正
- ✅ #002 スクロール改善  
- ✅ #003 ログアウトアイコン改善

### ✅ v2.2 (エディタ機能拡張) - 完了: 2025-06-10  
- ✅ #005 不可視文字表示機能
- ✅ エディタヘッダーUI改善
- ✅ オーバーレイ表示最適化

### v3.0 (大型アップデート) - 予定: 2025-07-01
- TypeScript化
- リアルタイム同期改善
- オフライン機能
- PWA対応

---

## 🔄 課題管理プロセス

### 新規課題報告
1. このファイルに課題を追加
2. 優先度とラベルを設定
3. TodoWrite ツールでタスク追加
4. 調査・実装開始

### 進捗更新
- 日次でステータス更新
- 完了時はTodoWrite で完了マーク
- 重要な変更はGitコミットメッセージに記載

### ファイルベース管理の利点
- ✅ バージョン管理されている
- ✅ 検索可能
- ✅ Markdownでリッチなドキュメンテーション
- ✅ GitHubでの閲覧・編集が容易
- ✅ 外部ツール不要

---

## 📝 次回作業予定

1. **#001 データ競合調査** - 編集競合の再現テスト実施
2. **#002 スクロール改善** - パディング追加の実装
3. 課題管理プロセスの改善

最終更新: 2025-06-10  
管理者: Claude Code Assistant