<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ - å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .metric {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            text-align: center;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        .metric-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        #editor {
            width: 100%;
            height: 400px;
            font-family: monospace;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ« ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="warning">
            <strong>âš ï¸ æ³¨æ„:</strong> ã“ã®ãƒ†ã‚¹ãƒˆã¯å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ2.8MB, 8ä¸‡è¡Œè¶…ï¼‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ãŒä¸€æ™‚çš„ã«é‡ããªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
        </div>
        
        <div class="test-section">
            <h2>ğŸ§ª ãƒ†ã‚¹ãƒˆ1: ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿æ€§èƒ½</h2>
            <p>å¤§å®¹é‡ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿æ™‚é–“ã¨ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’æ¸¬å®šã—ã¾ã™ã€‚</p>
            
            <button onclick="testFileLoad()">ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆé–‹å§‹</button>
            <button onclick="clearEditor()">ã‚¨ãƒ‡ã‚£ã‚¿ã‚¯ãƒªã‚¢</button>
            
            <div class="metrics">
                <div class="metric">
                    <div class="metric-value" id="loadTime">-</div>
                    <div class="metric-label">èª­ã¿è¾¼ã¿æ™‚é–“ (ms)</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="fileSize">-</div>
                    <div class="metric-label">ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º (MB)</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="lineCount">-</div>
                    <div class="metric-label">è¡Œæ•°</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="memoryUsage">-</div>
                    <div class="metric-label">ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ (MB)</div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“ ãƒ†ã‚¹ãƒˆ2: ã‚¨ãƒ‡ã‚£ã‚¿æ“ä½œæ€§èƒ½</h2>
            <p>å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ç·¨é›†æ“ä½œã®å¿œç­”æ€§ã‚’ç¢ºèªã—ã¾ã™ã€‚</p>
            
            <button onclick="testEditingPerformance()">ç·¨é›†æ€§èƒ½ãƒ†ã‚¹ãƒˆé–‹å§‹</button>
            <button onclick="testScrollingPerformance()">ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ€§èƒ½ãƒ†ã‚¹ãƒˆ</button>
            
            <div class="metrics">
                <div class="metric">
                    <div class="metric-value" id="editResponseTime">-</div>
                    <div class="metric-label">ç·¨é›†å¿œç­”æ™‚é–“ (ms)</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="scrollResponseTime">-</div>
                    <div class="metric-label">ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¿œç­”æ™‚é–“ (ms)</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="renderTime">-</div>
                    <div class="metric-label">å†æç”»æ™‚é–“ (ms)</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="fps">-</div>
                    <div class="metric-label">å¹³å‡FPS</div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“„ ã‚¨ãƒ‡ã‚£ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
            <p>ãƒ†ã‚¹ãƒˆç”¨ã®å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ãŒã“ã“ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚</p>
            <textarea id="editor" placeholder="ã“ã“ã«å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã™..."></textarea>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“‹ ãƒ†ã‚¹ãƒˆãƒ­ã‚°</h2>
            <div class="log" id="testLog">ãƒ†ã‚¹ãƒˆé–‹å§‹å‰...</div>
        </div>
    </div>

    <script>
        let testData = '';
        let performanceMetrics = {};
        
        function log(message) {
            const logElement = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }
        
        function updateMetric(elementId, value, unit = '') {
            document.getElementById(elementId).textContent = value + unit;
        }
        
        function getMemoryUsage() {
            if (performance.memory) {
                return (performance.memory.usedJSHeapSize / (1024 * 1024)).toFixed(2);
            }
            return 'N/A';
        }
        
        async function loadTestFile() {
            try {
                log('ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...');
                const response = await fetch('./test_large_note.md');
                if (!response.ok) {
                    throw new Error('ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                testData = await response.text();
                
                const sizeBytes = new Blob([testData]).size;
                const sizeMB = (sizeBytes / (1024 * 1024)).toFixed(2);
                const lines = testData.split('\n').length;
                
                updateMetric('fileSize', sizeMB, ' MB');
                updateMetric('lineCount', lines.toLocaleString());
                
                log(`ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿å®Œäº†: ${sizeMB}MB, ${lines.toLocaleString()}è¡Œ`);
                return true;
            } catch (error) {
                log(`ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                log('ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚generate_test_data.py ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
                return false;
            }
        }
        
        async function testFileLoad() {
            log('=== ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
            
            if (!testData) {
                const loaded = await loadTestFile();
                if (!loaded) return;
            }
            
            const startTime = performance.now();
            const startMemory = getMemoryUsage();
            
            log('ã‚¨ãƒ‡ã‚£ã‚¿ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...');
            
            // ã‚¨ãƒ‡ã‚£ã‚¿ã«èª­ã¿è¾¼ã¿
            const editor = document.getElementById('editor');
            editor.value = testData;
            
            const endTime = performance.now();
            const endMemory = getMemoryUsage();
            const loadTime = (endTime - startTime).toFixed(2);
            
            updateMetric('loadTime', loadTime, ' ms');
            updateMetric('memoryUsage', endMemory, ' MB');
            
            log(`èª­ã¿è¾¼ã¿å®Œäº†: ${loadTime}ms`);
            log(`ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ${startMemory}MB â†’ ${endMemory}MB`);
            log('=== ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆå®Œäº† ===');
        }
        
        function testEditingPerformance() {
            log('=== ç·¨é›†æ€§èƒ½ãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
            
            const editor = document.getElementById('editor');
            if (!editor.value) {
                log('ã‚¨ãƒ©ãƒ¼: ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            const testString = '\nãƒ†ã‚¹ãƒˆç·¨é›†: ' + new Date().toISOString();
            const iterations = 10;
            let totalTime = 0;
            
            log(`${iterations}å›ã®ç·¨é›†æ“ä½œã‚’å®Ÿè¡Œä¸­...`);
            
            for (let i = 0; i < iterations; i++) {
                const startTime = performance.now();
                
                // ãƒ†ã‚­ã‚¹ãƒˆã®æœ«å°¾ã«è¿½åŠ 
                editor.value += testString + ` (${i + 1})`;
                
                // DOMæ›´æ–°ã‚’å¼·åˆ¶
                editor.scrollTop = editor.scrollHeight;
                
                const endTime = performance.now();
                totalTime += (endTime - startTime);
            }
            
            const avgTime = (totalTime / iterations).toFixed(2);
            updateMetric('editResponseTime', avgTime, ' ms');
            
            log(`å¹³å‡ç·¨é›†å¿œç­”æ™‚é–“: ${avgTime}ms`);
            log('=== ç·¨é›†æ€§èƒ½ãƒ†ã‚¹ãƒˆå®Œäº† ===');
        }
        
        function testScrollingPerformance() {
            log('=== ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ€§èƒ½ãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
            
            const editor = document.getElementById('editor');
            if (!editor.value) {
                log('ã‚¨ãƒ©ãƒ¼: ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            let frameCount = 0;
            let totalFrameTime = 0;
            const testDuration = 2000; // 2ç§’é–“
            
            const startTime = performance.now();
            let lastFrameTime = startTime;
            
            function scrollTest() {
                const currentTime = performance.now();
                const frameTime = currentTime - lastFrameTime;
                
                if (frameTime > 0) {
                    totalFrameTime += frameTime;
                    frameCount++;
                }
                
                // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ“ä½œ
                editor.scrollTop = (currentTime % 1000) / 1000 * (editor.scrollHeight - editor.clientHeight);
                
                lastFrameTime = currentTime;
                
                if (currentTime - startTime < testDuration) {
                    requestAnimationFrame(scrollTest);
                } else {
                    // ãƒ†ã‚¹ãƒˆå®Œäº†
                    const avgFrameTime = (totalFrameTime / frameCount).toFixed(2);
                    const fps = (1000 / (totalFrameTime / frameCount)).toFixed(1);
                    
                    updateMetric('scrollResponseTime', avgFrameTime, ' ms');
                    updateMetric('fps', fps);
                    
                    log(`å¹³å‡ãƒ•ãƒ¬ãƒ¼ãƒ æ™‚é–“: ${avgFrameTime}ms`);
                    log(`å¹³å‡FPS: ${fps}`);
                    log('=== ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ€§èƒ½ãƒ†ã‚¹ãƒˆå®Œäº† ===');
                }
            }
            
            log('2ç§’é–“ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...');
            requestAnimationFrame(scrollTest);
        }
        
        function clearEditor() {
            document.getElementById('editor').value = '';
            log('ã‚¨ãƒ‡ã‚£ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
            
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚‚ãƒªã‚»ãƒƒãƒˆ
            updateMetric('loadTime', '-');
            updateMetric('editResponseTime', '-');
            updateMetric('scrollResponseTime', '-');
            updateMetric('renderTime', '-');
            updateMetric('fps', '-');
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            log('ãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ±: ' + navigator.userAgent);
            log('åˆæœŸãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ' + getMemoryUsage() + ' MB');
            
            // å®šæœŸçš„ã«ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’æ›´æ–°
            setInterval(() => {
                updateMetric('memoryUsage', getMemoryUsage(), ' MB');
            }, 1000);
        });
    </script>
</body>
</html>